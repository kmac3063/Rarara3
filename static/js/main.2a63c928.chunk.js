(this["webpackJsonpmini-app"]=this["webpackJsonpmini-app"]||[]).push([[0],{129:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(19),i=n.n(r),s=n(12),a=n.n(s),d=n(18),o=n.n(d),l=n(22),j=n(13),u=n(8),h=(n(127),n(130)),b=n(4),f=function(e){var t=e.id,n=(e.go,e.fetchedUser,e.callFriend);return Object(b.jsxs)(u.i,{id:t,children:[Object(b.jsx)(u.j,{children:"\u0412\u044b\u0431\u0438\u0440\u0430\u0439 \u0434\u0440\u0443\u0433\u0430"}),Object(b.jsx)(u.e,{onClick:n,before:Object(b.jsx)(h.a,{}),children:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u0440\u0443\u0433\u0430"})]})},O=(n.p,n(131)),p=function(e){var t,n=e.id,c=e.fetchedUser,r=e.go;return Object(b.jsx)(u.i,{id:n,children:Object(b.jsx)(u.g,{children:Object(b.jsx)(u.l,{icon:Object(b.jsx)(O.a,{}),header:"\u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u043c, "+(t=c,(null==t||null==t.first_name?"\u041f\u0440\u0438\u044f\u0442\u0435\u043b\u044c":c.first_name)+"!"),action:Object(b.jsx)(u.d,{size:"m",onClick:r,"data-to":"Home",children:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u0441\u043f\u0438\u0441\u043a\u0443 \u0434\u0440\u0443\u0437\u0435\u0439"}),children:"\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 \u0444\u0438\u043d\u0430\u043b\u0430 \u0445\u0430\u043a\u0430\u0442\u043e\u043d\u0430."})})})},m=n(132),x=n(133),y=n(134),g=function(e){var t=e.id,n=e.go,r=e.fetchedUser,i=e.friend,s=e.meShacking,a=(e.coord,e.speed,e.setMeShacking),d=Object(c.useState)(!1),o=Object(j.a)(d,2),l=o[0],h=o[1],f=Object(c.useState)(!0),O=Object(j.a)(f,2),p=O[0],g=O[1];return Object(c.useEffect)((function(){var e=setInterval((function(){var e={method:"GET",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id})};fetch("http://104.248.245.109/get_handshake",e).then((function(e){return e.json()})).then((function(e){g((function(){return e.friend_id===r.id})),h((function(){return 1===e.shake||"1"===e.shake}))}))}),500),t=setInterval((function(){a((function(e){if(null===r||null===i)return e;var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r.id,friend_id:i.id,shake:e?1:0})};return console.log("body: "+JSON.stringify({id:r.id,friend_id:i.id,shake:e})),fetch("http://104.248.245.109/set_handshake",t),e}))}),500);return function(){if(console.log("unmount"),clearTimeout(e),clearTimeout(t),null!==r){var n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r.id,friend_id:null,shake:!1})};fetch("https://jsonplaceholder.typicode.com/posts/1",n)}}}),[]),Object(b.jsxs)(u.i,{id:t,children:[Object(b.jsx)(u.j,{left:Object(b.jsx)(u.k,{onClick:n,"data-to":"Home"}),children:"\u0422\u0435\u0442-\u0430-\u0442\u0435\u0442"}),Object(b.jsx)(u.g,{header:Object(b.jsx)(u.h,{mode:"secondary",children:"\u0412\u044b"}),children:Object(b.jsxs)(u.f,{style:{display:"flex"},children:[Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"commerce",style:{marginRight:8},children:"\u0412\u044b \u0432 \u0442\u0435\u0442-\u0430-\u0442\u0435\u0442"}),s?Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"commerce",children:"\u0412\u044b \u0442\u0440\u044f\u0441\u0435\u0442\u0435"}):Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"secondary",children:"\u0412\u044b \u043d\u0435 \u0442\u0440\u044f\u0441\u0435\u0442\u0435"})]})}),Object(b.jsx)(u.g,{header:Object(b.jsx)(u.h,{mode:"secondary",children:(null!==i?i.first_name:"...")+" "+(null!==i?i.last_name:"")}),children:Object(b.jsxs)(u.f,{style:{display:"flex"},children:[p?Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"commerce",style:{marginRight:8},children:"\u0412 \u0442\u0435\u0442-\u0430-\u0442\u0435\u0442"}):Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"secondary",style:{marginRight:8},children:"\u041d\u0435 \u0432 \u0442\u0435\u0442-\u0430-\u0442\u0435\u0442"}),l?Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"commerce",children:"\u0422\u0440\u044f\u0441\u0435\u0442"}):Object(b.jsx)(u.d,{size:"l",stretched:!0,mode:"secondary",children:"\u041d\u0435 \u0442\u0440\u044f\u0441\u0435\u0442"})]})}),Object(b.jsx)(u.n,{}),s&&p&&l?Object(b.jsxs)(u.f,{style:{margin:0,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",textAlign:"center",padding:32},children:[Object(b.jsx)(u.c,{children:Object(b.jsx)(m.a,{})}),Object(b.jsx)(u.e,{children:"\u0412\u044b \u0442\u0440\u044f\u0441\u0435\u0442\u0435 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e!"}),Object(b.jsx)(u.c,{children:Object(b.jsx)(m.a,{})})]}):Object(b.jsx)(u.l,{icon:s?Object(b.jsx)(x.a,{fill:"DC143C"}):Object(b.jsx)(y.a,{fill:"DC143C"}),header:"\u0422\u0440\u044f\u0441\u044c\u0442\u0438 \u043d\u0443\u0436\u043d\u043e \u0441\u0438\u043b\u044c\u043d\u043e!"})]})},v=function(){arguments.length>0&&void 0!==arguments[0]||allowedList;return function(){var e=Object(c.useState)("WelcomeScreen"),t=Object(j.a)(e,2),n=t[0],r=t[1],i=Object(c.useState)(null),s=Object(j.a)(i,2),d=s[0],h=s[1],O=Object(c.useState)(Object(b.jsx)(u.m,{size:"large"})),m=Object(j.a)(O,2),x=m[0],y=m[1],v=Object(c.useState)(null),S=Object(j.a)(v,2),k=(S[0],S[1]),z=Object(c.useState)(null),C=Object(j.a)(z,2),_=C[0],A=C[1],T=Object(c.useState)(null),U=Object(j.a)(T,2),W=U[0],w=U[1],I=Object(c.useState)(0),K=Object(j.a)(I,2),V=K[0],J=K[1],F=Object(c.useState)({x:0,y:0,z:0}),N=Object(j.a)(F,2),E=N[0],D=N[1],G=Object(c.useState)(10),H=Object(j.a)(G,2);H[0],H[1];Object(c.useEffect)((function(){function e(){return(e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(null),e.next=3,a.a.send("VKWebAppGetUserInfo");case 3:t=e.sent,a.a.send("VKWebAppAccelerometerStart",{refresh_rate:200}),h(t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a.a.subscribe((function(e){var t=e.detail,n=t.type,c=t.data;if("VKWebAppUpdateConfig"===n){var r=document.createAttribute("scheme");r.value="client_light",k(r.value),document.body.attributes.setNamedItem(r)}if("VKWebAppAccelerometerChanged"===n){var i=c.x,s=c.y,a=c.z,d=Math.sqrt(i*i+s*s+a*a);w((function(){return d>11})),J((function(){return d})),D((function(){return{x:i,y:s,z:a}}))}}));var t=setInterval((function(){var e=E,t=null;setTimeout((function(){t=E,e.x===t.x&&e.y===t.y&&e.z===t.z&&a.a.send("VKWebAppAccelerometerStart",{refresh_rate:200})}),500)}),1e3);return function(){e.apply(this,arguments)}(),function(){null!==t&&clearTimeout(t)}}),[]);var M=function(e){r(e.currentTarget.dataset.to)},P=function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.a.send("VKWebAppGetFriends",{}).then((function(e){A((function(){return e.users[0]})),r((function(){return"Friend"}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(b.jsx)(u.a,{children:Object(b.jsx)(u.b,{children:Object(b.jsxs)(u.o,{activePanel:n,popout:x,children:[Object(b.jsx)(p,{id:"WelcomeScreen",fetchedUser:d,go:M}),Object(b.jsx)(f,{id:"Home",fetchedUser:d,go:M,callFriend:P}),Object(b.jsx)(g,{id:"Friend",fetchedUser:d,go:M,friend:_,meShacking:W,setMeShacking:w,coord:E,speed:V})]})})})}()};a.a.send("VKWebAppInit"),i.a.render(Object(b.jsx)(v,{}),document.getElementById("root"))}},[[129,1,2]]]);
//# sourceMappingURL=main.2a63c928.chunk.js.map